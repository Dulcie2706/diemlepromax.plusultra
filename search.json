[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "diem",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books.\n\n1 + 1\n\n[1] 2",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "baocao_Rt_Soi_2024.html",
    "href": "baocao_Rt_Soi_2024.html",
    "title": "1  Ước tính Rt của Sởi năm 2024",
    "section": "",
    "text": "Dữ liệu hiện có không thể tính được Serial interval theo định nghĩa. Do đó, sẽ dựa vào y văn và chọn Serial interval có trung bình là 14,5 ngày và độ lệch chuẩn là 3,25 ngày ((worden2020?)).\n\n2 Clean data\nDữ liệu miss ngày khởi phát\n\n# Làm sạch dữ liệu:\n\ndf1 &lt;- df1 %&gt;% clean_names()\n\n# Đổi tên ngày khởi phát, ngày sinh, ngày nhập viện khám, tình trạng tiêm chủng, giới tính:\n\ndf &lt;- df1 %&gt;% rename(dates = ngay_khoi_phat,\n                    ngaysinh = ngay_sinh,\n                    ngaynv = ngay_nhap_vien_kham,\n                    tiemchung = tinh_trang_tiem_chung,\n                    gioi = gioi_tinh)\n\nsum(is.na(df$dates))\n\n[1] 173\n\n# Lấy ngày nhập viện thay cho ngày khởi phát của các ca missing\ndf$dates[is.na(df$dates)] &lt;- df$ngaynv[is.na(df$dates)]\nsum(is.na(df$dates))\n\n[1] 0\n\n\nCó 173 ca bị missing Ngày khởi phát nên sử dụng Ngày nhập viện thay thế cho những ca này.\n\n\n3 Ước tính hệ số lây nhiễm Rt\n\nBộ dữ liệu bao gồm những ca Sởi xác định (Sởi lâm sàng + Sởi xét nghiệm dương tính) từ ngày 04/03/2024 đến 14/09/2024. Sử dụng ngày khởi phát để ước tính Rt .\n\n\n# Tạo cột cd nếu là Loại trừ sởi thì ghi NA\ndf$cd &lt;- ifelse(df$phan_loai_chan_doan == \"Loại trừ sởi\", NA, df$phan_loai_chan_doan)\ndf &lt;- df[,c(\"dates\", \"ngaysinh\", \"tiemchung\", \"cd\")]\n\n# Loại những ca Sởi loại trừ\ndf &lt;- na.omit(df)\n\ndf_convert &lt;- df %&gt;% group_by(dates) %&gt;% \n  summarise(I = n())\n\ndf_complete &lt;- df_convert %&gt;%\n    complete(dates = seq(min(dates), max(dates), by = \"day\")) %&gt;%\n    replace_na(list(I = 0))\n\ndf_complete$dates &lt;- as.Date(df_complete$dates)\n\n\nmod_raw &lt;- estimate_R(\n  incid = df_complete, # Dữ liệu từ 04/03/2024 - end\n  method = \"parametric_si\", \n  config = make_config(\n    list(\n      mean_si = 14.5, \n      std_si = 3.25\n    )\n  )\n)\n\nDefault config will estimate R on weekly sliding windows.\n    To change this change the t_start and t_end arguments. \n\n\nWarning in estimate_R_func(incid = incid, method = method, si_sample = si_sample, : You're estimating R too early in the epidemic to get the desired\n            posterior CV.\n\n\n\ndf_rt_raw &lt;- mod_raw$R\ndf_rt_raw$dates &lt;- mod_raw$dates[df_rt_raw$t_end]\ndf_rt_raw$q1_rt &lt;- df_rt_raw$`Quantile.0.025(R)`\ndf_rt_raw$q3_rt &lt;- df_rt_raw$`Quantile.0.975(R)`\ndf_rt_raw$rt &lt;- df_rt_raw$`Mean(R)`\n\nƯớc tính hệ số lây nhiễm Rt\n\nlibrary(patchwork)\n\np_hist_raw &lt;- ggplot(df_complete, aes(x = dates, y = I)) +\n    geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill = \"lightgrey\", color = \"black\") +\n    labs(x = \"Day\", y = \"Incidence\") +\n    theme_minimal() + \n    theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n    scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-03-04\"), ymd(\"2024-09-14\")))\n\nWarning in geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill =\n\"lightgrey\", : Ignoring unknown parameters: `binwidth`, `bins`, and `pad`\n\np_raw &lt;- ggplot(df_rt_raw, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"04/03/2024 - 14/09/2024\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +\n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-03-04\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 50))\n\np_hist_raw/p_raw\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\nKhi ước tính Rt từ 04/03/2024 thì có thể là quá sớm vì các ca bệnh xuất hiện lẻ tẻ từ 04/03/2024 đến khoảng 30/05/2024. Số ca bệnh bắt đầu xuất hiện liên tục từ 30/05/2024 nên sẽ ước tính Rt từ ngày này. Do đó, Rt sẽ được ước tính từ 30/05/2024 đến 10/09/2024. Code\n\n\n# Lọc dữ liệu từ 30/05/2024 - end\ndf_filter &lt;- filter(df_complete, dates &gt;= \"2024-05-30\")\n\n\nmod_1w &lt;- estimate_R(\n  incid = df_filter, \n  method = \"parametric_si\", \n  config = make_config(\n    list(\n      mean_si = 14.5, \n      std_si = 3.25\n    )\n  )\n)\n\nDefault config will estimate R on weekly sliding windows.\n    To change this change the t_start and t_end arguments. \n\n\n\n# Lấy dữ liệu ra để vẽ Rt\ndf_rt_1w &lt;- mod_1w$R\ndf_rt_1w$dates &lt;- mod_1w$dates[df_rt_1w$t_end]\ndf_rt_1w$q1_rt &lt;- df_rt_1w$`Quantile.0.025(R)`\ndf_rt_1w$q3_rt &lt;- df_rt_1w$`Quantile.0.975(R)`\ndf_rt_1w$rt &lt;- df_rt_1w$`Mean(R)`\n\n\nlibrary(patchwork)\n\n# Biểu đồ đường cong dịch\np_hist &lt;- ggplot(df_filter, aes(x = dates, y = I)) +\n    geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill = \"lightgrey\", color = \"black\") +\n    labs(x = \"Day\", y = \"Incidence\") +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n    scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\")))\n\nWarning in geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill =\n\"lightgrey\", : Ignoring unknown parameters: `binwidth`, `bins`, and `pad`\n\n# Biểu đồ cho 1 tuần\np_1w &lt;- ggplot(df_rt_1w, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"30/05/2024 - 14/09/2024\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +\n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 20))\n\n\nlibrary(patchwork)\n\n(p_hist_raw + p_hist) / (p_raw + p_1w)\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\nRemoved 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\nRemoved 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n# SW = 1\nt_start &lt;- seq(2, nrow(df_filter)-1)\nt_end &lt;- t_start + 1\n\nmod_day &lt;- estimate_R(\n  incid = df_filter, \n  method = \"parametric_si\", \n  config = make_config(\n    list(\n      mean_si = 14.5, \n      std_si = 3.25,\n      t_start = t_start,\n      t_end = t_end\n    )\n  )\n)\n\nWarning in estimate_R_func(incid = incid, method = method, si_sample = si_sample, : You're estimating R too early in the epidemic to get the desired\n            posterior CV.\n\n# Lấy dữ liệu ra để vẽ Rt\ndf_rt_day &lt;- mod_day$R\ndf_rt_day$dates &lt;- mod_day$dates[df_rt_day$t_end]\ndf_rt_day$q1_rt &lt;- df_rt_day$`Quantile.0.025(R)`\ndf_rt_day$q3_rt &lt;- df_rt_day$`Quantile.0.975(R)`\ndf_rt_day$rt &lt;- df_rt_day$`Mean(R)`\n\n\n# SW = 14\nt_start &lt;- seq(2, nrow(df_filter)-13)\nt_end &lt;- t_start + 13\n\nmod_2w &lt;- estimate_R(\n  incid = df_filter, \n  method = \"parametric_si\", \n  config = make_config(\n    list(\n      mean_si = 14.5, \n      std_si = 3.25,\n      t_start = t_start,\n      t_end = t_end\n    )\n  )\n)\n\n# Lấy dữ liệu ra để vẽ Rt\ndf_rt_2w &lt;- mod_2w$R\ndf_rt_2w$dates &lt;- mod_2w$dates[df_rt_2w$t_end]\ndf_rt_2w$q1_rt &lt;- df_rt_2w$`Quantile.0.025(R)`\ndf_rt_2w$q3_rt &lt;- df_rt_2w$`Quantile.0.975(R)`\ndf_rt_2w$rt &lt;- df_rt_2w$`Mean(R)`\n\n\n# SW = 28\nt_start &lt;- seq(2, nrow(df_filter)-27)\nt_end &lt;- t_start + 27\n\nmod_month &lt;- estimate_R(\n  incid = df_filter, \n  method = \"parametric_si\", \n  config = make_config(\n    list(\n      mean_si = 14.5, \n      std_si = 3.25,\n      t_start = t_start,\n      t_end = t_end\n    )\n  )\n)\n\n# Lấy dữ liệu ra để vẽ Rt\ndf_rt_month &lt;- mod_month$R\ndf_rt_month$dates &lt;- mod_month$dates[df_rt_month$t_end]\ndf_rt_month$q1_rt &lt;- df_rt_month$`Quantile.0.025(R)`\ndf_rt_month$q3_rt &lt;- df_rt_month$`Quantile.0.975(R)`\ndf_rt_month$rt &lt;- df_rt_month$`Mean(R)`\n\n\nlibrary(patchwork)\n\n# Biểu đồ đường cong dịch\np_hist &lt;- ggplot(df_filter, aes(x = dates, y = I)) +\n    geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill = \"lightgrey\", color = \"black\") +\n    labs(x = \"Day\", y = \"Incidence\") +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n    scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\")))\n\nWarning in geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill =\n\"lightgrey\", : Ignoring unknown parameters: `binwidth`, `bins`, and `pad`\n\n# Biểu đồ cho 1 tuần\np_1w &lt;- ggplot(df_rt_1w, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"1 Week\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 8))\n\n# Biểu đồ cho 1 ngày\np_day &lt;- ggplot(df_rt_day, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"1 Day\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 10))\n\n# Biểu đồ cho 2 tuần\np_2w &lt;- ggplot(df_rt_2w, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"2 Week\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 10))\n\n# Biểu đồ cho 1 tháng\np_month &lt;- ggplot(df_rt_month, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"1 Month\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +\n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(limits = c(0, 5))\n\n(p_hist + p_hist)/(p_day + p_1w)\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\nWarning: Removed 12 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\nlibrary(patchwork)\n\n(p_hist + p_hist)/(p_2w + p_month)\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\nRemoved 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\n\n\n\n\n\n\n\n\n\n4 Ước tính Rt với sliding window là 2 tuần\n\nlibrary(patchwork)\n\np_hist &lt;- ggplot(df_filter, aes(x = dates, y = I)) +\n    geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill = \"lightgrey\", color = \"black\") +\n    labs(x = \"Day\", y = \"Incidence\") +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + \n    scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\")))\n\nWarning in geom_histogram(stat = \"identity\", binwidth = 1, width = 1, fill =\n\"lightgrey\", : Ignoring unknown parameters: `binwidth`, `bins`, and `pad`\n\np_2w &lt;- ggplot(df_rt_2w, aes(x = dates)) +\n  geom_ribbon(aes(ymin = q1_rt, ymax = q3_rt), fill = \"lightcoral\", alpha = 0.3) + \n  geom_line(aes(y = rt), color = \"darkorange\") +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"black\") + \n  labs(x = \"Day\", y = \"Rt\", title = \"13/06 - 14/09\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) + \n  scale_x_date(date_labels = \"%b %d\", date_breaks = \"1 week\", limits = c(ymd(\"2024-05-30\"), ymd(\"2024-09-14\"))) +\n  scale_y_continuous(breaks = seq(0,10,by = 2))\n\np_hist/p_2w\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n\n\n\n\n\n\n\n\n\n\nlibrary(knitr)\nkable(df_rt_2w[,c(\"dates\", \"rt\")])\n\n\n\n\ndates\nrt\n\n\n\n\n2024-06-13\n7.0698366\n\n\n2024-06-14\n5.6690111\n\n\n2024-06-15\n4.3508564\n\n\n2024-06-16\n3.2821600\n\n\n2024-06-17\n2.4718480\n\n\n2024-06-18\n2.1445391\n\n\n2024-06-19\n1.8320200\n\n\n2024-06-20\n1.7193623\n\n\n2024-06-21\n1.6256121\n\n\n2024-06-22\n1.5422473\n\n\n2024-06-23\n1.5176277\n\n\n2024-06-24\n1.4954698\n\n\n2024-06-25\n1.3944655\n\n\n2024-06-26\n1.4405630\n\n\n2024-06-27\n1.3418515\n\n\n2024-06-28\n1.1143724\n\n\n2024-06-29\n1.0995479\n\n\n2024-06-30\n1.2085188\n\n\n2024-07-01\n1.4736674\n\n\n2024-07-02\n1.5490903\n\n\n2024-07-03\n1.5791076\n\n\n2024-07-04\n1.5973473\n\n\n2024-07-05\n1.5671345\n\n\n2024-07-06\n1.4948245\n\n\n2024-07-07\n1.4237618\n\n\n2024-07-08\n1.3243248\n\n\n2024-07-09\n1.1656958\n\n\n2024-07-10\n1.0137158\n\n\n2024-07-11\n1.0568080\n\n\n2024-07-12\n1.0603317\n\n\n2024-07-13\n1.1164884\n\n\n2024-07-14\n1.0754648\n\n\n2024-07-15\n0.8953696\n\n\n2024-07-16\n0.9462627\n\n\n2024-07-17\n1.0530632\n\n\n2024-07-18\n1.0882127\n\n\n2024-07-19\n1.1613209\n\n\n2024-07-20\n1.2219629\n\n\n2024-07-21\n1.2947699\n\n\n2024-07-22\n1.4031893\n\n\n2024-07-23\n1.4613128\n\n\n2024-07-24\n1.5730353\n\n\n2024-07-25\n1.6793297\n\n\n2024-07-26\n1.7178643\n\n\n2024-07-27\n1.6554286\n\n\n2024-07-28\n1.6616364\n\n\n2024-07-29\n1.7875178\n\n\n2024-07-30\n1.7556702\n\n\n2024-07-31\n1.6092751\n\n\n2024-08-01\n1.4647907\n\n\n2024-08-02\n1.3967257\n\n\n2024-08-03\n1.3536969\n\n\n2024-08-04\n1.3559618\n\n\n2024-08-05\n1.3996821\n\n\n2024-08-06\n1.5009996\n\n\n2024-08-07\n1.6549297\n\n\n2024-08-08\n1.7120074\n\n\n2024-08-09\n1.8062972\n\n\n2024-08-10\n1.8852197\n\n\n2024-08-11\n1.9690807\n\n\n2024-08-12\n1.8912403\n\n\n2024-08-13\n1.9860504\n\n\n2024-08-14\n1.9307622\n\n\n2024-08-15\n1.9485278\n\n\n2024-08-16\n1.9479556\n\n\n2024-08-17\n1.9839644\n\n\n2024-08-18\n1.9756048\n\n\n2024-08-19\n1.9431634\n\n\n2024-08-20\n1.7682855\n\n\n2024-08-21\n1.6166982\n\n\n2024-08-22\n1.5031903\n\n\n2024-08-23\n1.4052603\n\n\n2024-08-24\n1.3527849\n\n\n2024-08-25\n1.3302986\n\n\n2024-08-26\n1.3423795\n\n\n2024-08-27\n1.2956510\n\n\n2024-08-28\n1.3565252\n\n\n2024-08-29\n1.3408987\n\n\n2024-08-30\n1.2963237\n\n\n2024-08-31\n1.2655504\n\n\n2024-09-01\n1.2486194\n\n\n2024-09-02\n1.2373010\n\n\n2024-09-03\n1.3128349\n\n\n2024-09-04\n1.3294864\n\n\n2024-09-05\n1.3233001\n\n\n2024-09-06\n1.2926711\n\n\n2024-09-07\n1.2373607\n\n\n2024-09-08\n1.1799842\n\n\n2024-09-09\n1.1565229\n\n\n2024-09-10\n1.1126126\n\n\n2024-09-11\n1.0638421\n\n\n2024-09-12\n1.0497415\n\n\n2024-09-13\n1.0363817\n\n\n2024-09-14\n1.0485225",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Ước tính Rt của Sởi năm 2024</span>"
    ]
  }
]